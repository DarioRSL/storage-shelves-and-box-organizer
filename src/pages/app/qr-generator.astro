---
import Layout from "@/layouts/Layout.astro";
import QRGeneratorView from "@/components/qr-generator/QRGeneratorView";
import { getAuthenticatedUserProfile } from "@/lib/services/profile.service";
import { log } from "@/lib/services/logger";

export const prerender = false;

// Check if user is authenticated via middleware (from sb_session cookie)
const user = Astro.locals.user;
if (!user) {
  return Astro.redirect("/auth");
}

// Fetch user profile for theme preference
const supabase = Astro.locals.supabase;
let themePreference = "system";
try {
  const profile = await getAuthenticatedUserProfile(supabase, user.id);
  themePreference = profile.theme_preference || "system";
} catch (error) {
  log.error("Failed to load user theme preference", { userId: user.id, error });
}
---

<Layout title="Generator kodÃ³w QR - Storage Organizer" themePreference={themePreference}>
  <main role="main">
    <QRGeneratorView client:load />
  </main>
</Layout>
